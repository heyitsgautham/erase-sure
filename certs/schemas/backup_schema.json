{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://schemas.securewipe.org/backup-certificate/v1.0.0",
    "title": "SecureWipe Backup Certificate",
    "type": "object",
    "definitions": {
        "issuer": {
            "type": "object",
            "properties": {
                "organization": {
                    "type": "string"
                },
                "tool_name": {
                    "type": "string"
                },
                "tool_version": {
                    "type": "string",
                    "pattern": "^v?\\d+\\.\\d+\\.\\d+(-[A-Za-z0-9.-]+)?$"
                },
                "country": {
                    "type": "string"
                }
            },
            "required": [
                "organization",
                "tool_name",
                "tool_version"
            ],
            "additionalProperties": false
        },
        "device": {
            "type": "object",
            "properties": {
                "model": {
                    "type": "string"
                },
                "serial": {
                    "type": "string"
                },
                "bus": {
                    "type": "string",
                    "enum": [
                        "SATA",
                        "NVMe",
                        "USB",
                        "SAS",
                        "VIRTIO",
                        "UNKNOWN"
                    ]
                },
                "capacity_bytes": {
                    "type": "integer",
                    "minimum": 0
                },
                "logical_block_size": {
                    "type": "integer",
                    "minimum": 1
                },
                "total_lbas": {
                    "type": "integer",
                    "minimum": 0
                },
                "firmware": {
                    "type": "string"
                },
                "namespace_id": {
                    "type": "string"
                },
                "path": {
                    "type": "string"
                }
            },
            "required": [
                "model",
                "serial",
                "bus",
                "capacity_bytes"
            ],
            "additionalProperties": false
        },
        "files_summary": {
            "type": "object",
            "properties": {
                "count": {
                    "type": "integer",
                    "minimum": 0
                },
                "personal_bytes": {
                    "type": "integer",
                    "minimum": 0
                },
                "included_paths": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "excluded_paths": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "count",
                "personal_bytes"
            ],
            "additionalProperties": false
        },
        "destination": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "usb",
                        "nas",
                        "other"
                    ]
                },
                "label": {
                    "type": "string"
                },
                "fs": {
                    "type": "string"
                },
                "mountpoint": {
                    "type": "string"
                },
                "path": {
                    "type": "string"
                }
            },
            "required": [
                "type"
            ],
            "additionalProperties": false
        },
        "crypto": {
            "type": "object",
            "properties": {
                "alg": {
                    "const": "AES-256-CTR"
                },
                "manifest_sha256": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                },
                "key_management": {
                    "type": "string",
                    "enum": [
                        "ephemeral_session_key",
                        "external_kms",
                        "user_provided_key"
                    ]
                }
            },
            "required": [
                "alg",
                "manifest_sha256",
                "key_management"
            ],
            "additionalProperties": false
        },
        "verification": {
            "type": "object",
            "properties": {
                "strategy": {
                    "type": "string",
                    "enum": [
                        "random_sectors",
                        "full_readback",
                        "controller_status",
                        "sampled_files"
                    ]
                },
                "samples": {
                    "type": "integer",
                    "minimum": 0
                },
                "coverage": {
                    "type": "object",
                    "properties": {
                        "mode": {
                            "type": "string",
                            "enum": [
                                "percent",
                                "samples"
                            ]
                        },
                        "percent": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 100
                        },
                        "samples": {
                            "type": "integer",
                            "minimum": 0
                        }
                    },
                    "oneOf": [
                        {
                            "properties": {
                                "mode": {
                                    "const": "percent"
                                },
                                "percent": {
                                    "type": "number"
                                }
                            },
                            "required": [
                                "mode",
                                "percent"
                            ]
                        },
                        {
                            "properties": {
                                "mode": {
                                    "const": "samples"
                                },
                                "samples": {
                                    "type": "integer"
                                }
                            },
                            "required": [
                                "mode",
                                "samples"
                            ]
                        }
                    ],
                    "additionalProperties": false
                },
                "failures": {
                    "type": "integer",
                    "minimum": 0
                },
                "notes": {
                    "type": "string"
                }
            },
            "required": [
                "strategy",
                "failures"
            ],
            "additionalProperties": false
        },
        "policy": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "default": "NIST SP 800-88 Rev.1"
                },
                "version": {
                    "type": "string"
                }
            },
            "required": [
                "name",
                "version"
            ],
            "additionalProperties": false
        },
        "environment": {
            "type": "object",
            "properties": {
                "operator": {
                    "type": "string"
                },
                "os_kernel": {
                    "type": "string"
                },
                "tool_version": {
                    "type": "string",
                    "pattern": "^v?\\d+\\.\\d+\\.\\d+(-[A-Za-z0-9.-]+)?$"
                },
                "device_firmware": {
                    "type": "string"
                },
                "containerized": {
                    "type": "boolean"
                }
            },
            "required": [
                "operator",
                "os_kernel",
                "tool_version"
            ],
            "additionalProperties": false
        },
        "exceptions": {
            "type": "object",
            "properties": {
                "items": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "text": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "signature": {
            "type": "object",
            "properties": {
                "alg": {
                    "const": "Ed25519"
                },
                "pubkey_id": {
                    "const": "sih_root_v1"
                },
                "sig": {
                    "type": "string",
                    "pattern": "^[A-Za-z0-9+/=]+$"
                },
                "canonicalization": {
                    "type": "string",
                    "enum": [
                        "RFC8785_JSON",
                        "deterministic_minified"
                    ]
                }
            },
            "required": [
                "alg",
                "pubkey_id",
                "sig"
            ],
            "additionalProperties": false
        },
        "metadata": {
            "type": "object",
            "properties": {
                "certificate_json_sha256": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                },
                "logs_sha256": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                },
                "qr_payload": {
                    "type": "object",
                    "properties": {
                        "cert_id": {
                            "type": "string"
                        },
                        "issued_at": {
                            "type": "string",
                            "format": "date-time"
                        },
                        "device_model": {
                            "type": "string"
                        },
                        "result": {
                            "type": "string",
                            "enum": [
                                "PASS",
                                "FAIL"
                            ]
                        },
                        "nist_level": {
                            "type": "string"
                        },
                        "method": {
                            "type": "string"
                        },
                        "sha256_cert_json": {
                            "type": "string",
                            "pattern": "^[a-f0-9]{64}$"
                        },
                        "verify_url": {
                            "type": "string",
                            "format": "uri"
                        },
                        "sig": {
                            "type": "string",
                            "pattern": "^[A-Za-z0-9+/=]+$"
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        }
    },
    "properties": {
        "cert_type": {
            "const": "backup"
        },
        "cert_id": {
            "type": "string",
            "pattern": "^[A-Za-z0-9._-]+$"
        },
        "certificate_version": {
            "type": "string",
            "pattern": "^v?\\d+\\.\\d+\\.\\d+(-[A-Za-z0-9.-]+)?$"
        },
        "created_at": {
            "type": "string",
            "format": "date-time"
        },
        "issuer": {
            "$ref": "#/definitions/issuer"
        },
        "device": {
            "$ref": "#/definitions/device"
        },
        "files_summary": {
            "$ref": "#/definitions/files_summary"
        },
        "destination": {
            "$ref": "#/definitions/destination"
        },
        "crypto": {
            "$ref": "#/definitions/crypto"
        },
        "verification": {
            "$ref": "#/definitions/verification"
        },
        "policy": {
            "$ref": "#/definitions/policy"
        },
        "result": {
            "type": "string",
            "enum": [
                "PASS",
                "FAIL"
            ]
        },
        "environment": {
            "$ref": "#/definitions/environment"
        },
        "exceptions": {
            "$ref": "#/definitions/exceptions"
        },
        "signature": {
            "$ref": "#/definitions/signature"
        },
        "metadata": {
            "$ref": "#/definitions/metadata"
        },
        "verify_url": {
            "type": "string",
            "format": "uri"
        }
    },
    "required": [
        "cert_type",
        "cert_id",
        "certificate_version",
        "created_at",
        "issuer",
        "device",
        "files_summary",
        "destination",
        "crypto",
        "verification",
        "policy",
        "result",
        "environment",
        "exceptions",
        "signature",
        "metadata"
    ],
    "additionalProperties": false,
    "examples": [
        {
            "cert_type": "backup",
            "cert_id": "BCK_2024_001",
            "certificate_version": "v1.0.0",
            "created_at": "2024-01-15T10:30:00+05:30",
            "issuer": {
                "organization": "SecureWipe (SIH)",
                "tool_name": "securewipe",
                "tool_version": "v2.1.0",
                "country": "IN"
            },
            "device": {
                "model": "Samsung SSD 980 PRO",
                "serial": "S6TXNX0R123456",
                "bus": "NVMe",
                "capacity_bytes": 1000204886016,
                "path": "/dev/nvme0n1"
            },
            "files_summary": {
                "count": 2847,
                "personal_bytes": 52428800
            },
            "destination": {
                "type": "usb",
                "label": "BACKUP_USB",
                "fs": "exfat"
            },
            "crypto": {
                "alg": "AES-256-CTR",
                "manifest_sha256": "d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2",
                "key_management": "ephemeral_session_key"
            },
            "verification": {
                "strategy": "sampled_files",
                "coverage": {
                    "mode": "percent",
                    "percent": 15.5
                },
                "failures": 0
            },
            "policy": {
                "name": "NIST SP 800-88 Rev.1",
                "version": "2023.12"
            },
            "result": "PASS",
            "environment": {
                "operator": "Automated",
                "os_kernel": "Linux 6.8.0-35-generic",
                "tool_version": "v2.1.0"
            },
            "exceptions": {
                "text": "None"
            },
            "signature": {
                "alg": "Ed25519",
                "pubkey_id": "sih_root_v1",
                "sig": "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef=="
            },
            "metadata": {
                "certificate_json_sha256": "a1b2c3d4e5f67890123456789012345678901234567890123456789012345678"
            }
        }
    ]
}