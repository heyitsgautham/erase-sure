{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Backup Certificate",
    "type": "object",
    "properties": {
        "cert_type": {
            "const": "backup"
        },
        "cert_id": {
            "type": "string",
            "minLength": 3
        },
        "device": {
            "type": "object",
            "properties": {
                "model": {
                    "type": "string"
                },
                "serial": {
                    "type": "string"
                },
                "bus": {
                    "type": "string"
                },
                "capacity_bytes": {
                    "type": "integer",
                    "minimum": 0
                }
            },
            "required": [
                "model",
                "capacity_bytes"
            ],
            "additionalProperties": false
        },
        "files_summary": {
            "type": "object",
            "properties": {
                "count": {
                    "type": "integer",
                    "minimum": 0
                },
                "personal_bytes": {
                    "type": "integer",
                    "minimum": 0
                }
            },
            "required": [
                "count",
                "personal_bytes"
            ],
            "additionalProperties": false
        },
        "destination": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "usb",
                        "nas",
                        "cloud",
                        "other"
                    ]
                },
                "label": {
                    "type": "string"
                },
                "fs": {
                    "type": "string"
                }
            },
            "required": [
                "type"
            ],
            "additionalProperties": false
        },
        "crypto": {
            "type": "object",
            "properties": {
                "alg": {
                    "type": "string",
                    "enum": [
                        "AES-256-CTR"
                    ]
                },
                "manifest_sha256": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                }
            },
            "required": [
                "alg",
                "manifest_sha256"
            ],
            "additionalProperties": false
        },
        "created_at": {
            "type": "string",
            "format": "date-time"
        },
        "signature": {
            "type": "object",
            "properties": {
                "alg": {
                    "type": "string",
                    "enum": [
                        "Ed25519"
                    ]
                },
                "sig": {
                    "type": "string"
                },
                "pubkey_id": {
                    "type": "string",
                    "const": "sih_root_v1"
                }
            },
            "required": [
                "alg",
                "sig",
                "pubkey_id"
            ],
            "additionalProperties": false
        }
    },
    "required": [
        "cert_type",
        "cert_id",
        "device",
        "files_summary",
        "destination",
        "crypto",
        "created_at",
        "signature"
    ],
    "additionalProperties": false
}